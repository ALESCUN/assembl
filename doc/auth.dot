strict digraph {

    login;
    "request_password_change";
    "email confirm link email";
    "password change link email";
    "assembl (logged out)";
    "profile";
    "assembl (logged in)";
    "user_confirm_email";
    #"confirm_user_email";
    "confirm_email_request" ;
    "password_change_request";

    login -> "assembl (logged in)" [label=login];
    login->login [label="bad login", color=red];
    login -> "confirm_email_request" [label="register"];
    login -> "social login";
    "social login" -> "assembl (logged in)";
    "social login" -> login [color=red, label="failed social login"];
    login -> "confirm_email_request" [label="login, unconfirmed"];
    "confirm_email_request" -> "confirm_email_request" [label=resend];
    confirm_email_request -> "email confirm link email";
    "email confirm link email"->user_confirm_email;
    user_confirm_email->"assembl (logged in)" [label=301];
    user_confirm_email->confirm_email_request [label="reuse link, 301", color=red];
    login->request_password_change [label="request password change"];
    request_password_change->password_change_request;
    password_change_request->password_change_request [label=resend];
    password_change_request->"password change link email";
    "password change link email"->"password_change_page" [label="use link (may confirm email)"];

    "password_change_page"->"assembl (logged in)" [label="change password"];
    "password_change_page"->"password_change_page" [label="passwords don't match"];
    "password_change_page"->"password_change_request" [label="reuse link, 301", color=red];
    "assembl (logged in)" -> "assembl (logged out)" [label="logout"];
    "assembl (logged out)" -> login;
    login -> "social login" [label="social login while logged in"];
    "assembl (logged in)" -> profile [dir="both"];
    "profile" -> "social login" [label="add social login"];
    profile->profile [label="change password"];
    #"confirm_user_email"->"email confirm link email";
}