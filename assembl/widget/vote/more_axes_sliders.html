<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>More axes</title>
</head>
<body>

<style>

body {
  font: 10px sans-serif;
}

.axis path,
.axis line {
  fill: none;
  stroke: #000;
  shape-rendering: crispEdges;
}

</style>

<!-- we disable text selection in this div, to avoid ugly effects when the mouse interacts with the d3 graph -->
<div 
 id="d3_container"
 style='-moz-user-select: none; -webkit-user-select: none; -ms-user-select:none; user-select:none;' 
 unselectable='on'
 onselectstart='return false;' 
 onmousedown='return false;'>
</div>

<script src="js/d3.min.js"></script>
<script>

var config = {
  axes: [
    {
      name: 'Rentabilité',
      description: 'Description de l\'axe rentabilité',
      valueMin: 0,
      valueMax: 100,
      valueDefault: 10,
      ticks: 6
    },
    {
      name: 'Risque',
      description: 'Description de l\'axe risque',
      valueMin: 0,
      valueMax: 100,
      valueDefault: 0,
      ticks: 6
    },
    {
      name: 'Investissement',
      description: 'Description de l\'axe investissement',
      valueMin: 0,
      valueMax: 50000,
      valueDefault: 22222,
      ticks: 5
    },
    {
      name: 'Difficulté de mise en oeuvre',
      description: 'Description de l\'axe difficulté de mise en oeuvre',
      valueMin: 0,
      valueMax: 100,
      valueDefault: 50,
      ticks: 12
    },
  ],
  width: 900,
  height: 300,
  padding: 40,
  axisWidthDefault: 100,
};


var holder;

function setCirclePositionFromOutputRange(x,y)
{
  // use d3::scale::invert() to ensure that destination position is in the correct domain (not outside graph)
  var xInDomain = xScale.invert(x);
  var yInDomain = yScale.invert(y);
  //updatePosX(xInDomain);
  updatePosY(yInDomain);
}

function getSelectorIndexByX(x)
{
  // find the nearest selector, but return -1 if the position clicked is too far
  var inv = xScale.invert(x);
  if ( (inv % 1.0) < 0.8 && (inv % 1.0) > 0.2 )
    return -1;
  return Math.round(xScale.invert(x));
}

function click()
{
  // Ignore the click event if it was suppressed
  if (d3.event.defaultPrevented) return;

  // Extract the click location
  var point = d3.mouse(this);
  var p = {x: point[0], y: point[1] };

  // find on which slider the user is clicking

  var indexSelector = getSelectorIndexByX(p.x);

  if ( indexSelector >= 0 && indexSelector < config.axes.length )
    d3.select("#circle"+indexSelector).attr("cy", scales[indexSelector](scales[indexSelector].invert(p.y)));
}

function dragmove(d) {
  var x = d3.event.x;
  var y = d3.event.y;

  var indexSelector = getSelectorIndexByX(x);

  if ( indexSelector >= 0 && indexSelector < config.axes.length )
    d3.select(this).attr("cy", scales[indexSelector](scales[indexSelector].invert(y)));
}

// create scales

var scales = [];
var axes = [];
for ( var i = 0; i < config.axes.length; ++i )
{
  // vertical scales
  var scale = d3.scale.linear()
    .domain([config.axes[i].valueMin, config.axes[i].valueMax])
    .range([config.height - config.padding, config.padding*2])
    .clamp(true);
  scales.push(scale);

  var ticks = 5;
  if ( config.axes[i].ticks )
    ticks = config.axes[i].ticks;
  var axis = d3.svg.axis()
    .scale(scale)
    .orient("left")
    .ticks(ticks);
  axes.push(axis);
}

var xScale = d3.scale.linear()
  //.domain([0, config.width])
  .domain([0, config.axes.length])
  .range([config.padding, config.width - config.padding * 2])
  .clamp(true);


// create (hidden) X axis using its scale
var xAxis = d3.svg.axis()
  .scale(xScale)
  .orient("bottom");

// define drag beavior
var drag = d3.behavior.drag()
  .on("drag", dragmove);

// create the graph
var holder = d3.select("#d3_container")
  .append("svg")
  .attr("width", config.width)    
  .attr("height", config.height)
  //.style("cursor", "pointer")
  //.call(drag)
  .on("click", click);

var svg = d3.select("#d3_container svg");


// show vertical axes and their label
for ( var i = 0; i < config.axes.length; ++i )
{
  var g = holder.append("g");
  g.append("g")
    .attr("class", "axis")
    .attr("transform", "translate(" + xScale(i) + ",0)")
    .call(axes[i]);
  g.append("text")
    .attr("y", config.height - config.padding/2 )
    .attr("x", xScale(i) )
    .style("text-anchor", "middle")
    .text(config.axes[i].name);
}


// draw the cursors
svg.selectAll("circle").data(config.axes).enter().append("circle")
  .attr("id", function(d, i){ return "circle"+i; })
  .attr("cx", function(d, i){ return xScale(i); })
  .attr("cy", function(d, i){ return scales[i](d.valueDefault); })
  .attr("r", 8)
  .style("fill", "blue")
  .style("cursor", "pointer")
  .call(drag);



</script>
</body>
</html>