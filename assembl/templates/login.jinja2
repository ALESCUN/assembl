{% extends 'base.jinja2' %}

{% macro form(name, title, image) %}
{% if name in providers %}
<form id="{{name}}" method="post" action="/login/{{name}}">
{% for k,v in kwargs.items() %}
    <input type="hidden" name="{{ k }}" value="{{ v }}" />
{% endfor %}
{% if name == "openid" %}
    <input type="text" name="openid_identifier" />
{% endif %}
{% if image %}
    <input type="image" value="" src="{{ STATIC_URL }}/img/loginbox/{{name}}.png" alt="{{title}}"/>
{% else %}
    <input type="submit" value="{{ title }}" />
{% endif %}
</form>
{% endif %}
{% endmacro %}

{% block content %}

<div class="loginbox sign-in">
    <header>
        <h1>{{ gettext("Log in to Assembl") }}</h1>
    </header>

    <div class="content">

        <div class="socialPart">
            <p class="login-box-title">{{ gettext("Log in using one of these social networks") }}</p>
            {% if providers %}
            <p>{{ gettext("Login with external tools")|safe }}</p>
            {% endif %}
            {{form('google', gettext('Login with Google'), true)}}
            {{form('twitter', gettext('Login with Twitter'), true)}}
            {{form('facebook', gettext('Login with Facebook'), true)}}
            {{form('yahoo', gettext('Login with Yahoo'), true, oauth='true', openid_identifier='yahoo.com')}}
            {{form('live', gettext('Login with Windows Live'), false)}}
            {{form('github', gettext('Login with Github'), false)}}
            {{form('bitbucket', gettext('Login with Bitbucket'), false)}}
            {{form('openid', gettext('Login with OpenID'), true)}}
        </div>

        <div class="signinSeparator left">
            <div class="mask"></div>
        </div>

        <div class="signinWrapper">
            <p class="login-box-title">{{ gettext("Already have an account?") }}</p>
            <div class="error-message">{{error}}</div>
            <form class="form" method="POST">
                <input type="hidden" name="next_view" value="{{next_view}}" />
                <input type="text" name="identifier" class="defaultfield" placeholder="{{ gettext('Email or username') }}" autofocus required />
                <div class="spacer spacer--big"></div>
                <input type="password" name="password" class="defaultfield" placeholder="{{ gettext('Password') }}" required />
                <div class="spacer spacer--big"></div>

                <table class="submitButtons">
                <tr><td>
                    <input type="submit" name="login" value="{{ gettext('Enter') }}" class="btn-pink" />
                </td><td>
                    <a href="/req_password_change">{{ gettext('I forgot my password') }}</a>
                </td></tr></table>
            </form>
                
            <div class="spacer spacer--big"></div>

            <p class="login-box-title">{{ gettext("No account yet?") }}</p>
            <form class="form inline" method="GET" action="/register"><input type="submit" value="{{ gettext('register') }}" class="button button--condensed" /></form>
        </div>
        
    </div>
</div>

{% endblock %}

{% block extra_js %}
<script type="text/javascript">requirejs(["main"]);</script>
{% endblock %}
