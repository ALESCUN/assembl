{% extends 'base.jinja2' %}

{% block header %}
    <div class="bar bar--main">
        <div class="bar-body">
            <div class="bar-right">
                <a> {{ gettext('Sign in') }} <i class="icon-user"></i> </a>
            </div>
        </div>
    </div>
{% endblock %}

{% macro form(name, title, image) %}
{% if name in providers %}
<form id="{{name}}" method="post" action="/login/{{name}}">
    {% for k,v in kwargs.items() %}
    <input type="hidden" name="{{ k }}" value="{{ v }}" />
    {% endfor %}
    {% if name == "openid" %}
    <input type="text" name="openid_identifier" />
    {% endif %}
    {% if image %}
    <input type="image" value="" src="{{ STATIC_URL }}img/loginbox/{{name}}.png" alt="{{gettext(title)}}"/>
    {% else %}
    <input type="submit" value="{{ gettext(title) }}" />
    {% endif %}
</form>
{% endif %}
{% endmacro %}

{% macro google_login() %}
<!-- Place this asynchronous JavaScript just before your </body> tag -->
<link href="http://fonts.googleapis.com/css?family=Roboto" rel="stylesheet" type="text/css">
<script type="text/javascript">
window.___gcfg = {
  lang: '{{locale}}'
};
(function() {
  var po = document.createElement('script');
  po.type = 'text/javascript'; po.async = true;
  po.src = 'https://apis.google.com/js/client:plusone.js?onload=render';
  var s = document.getElementsByTagName('script')[0];
  s.parentNode.insertBefore(po, s);
})();

function render() {
  gapi.signin.render('customBtn', {
    'clientid': '{{google_consumer_key}}',
    'cookiepolicy': 'single_host_origin',
    'requestvisibleactions': 'http://schemas.google.com/AddActivity',
    'scope': 'https://www.googleapis.com/auth/plus.login'
  });
}
</script>
<style type="text/css">
  #google_button {
    display: inline-block;
    background: #dd4b39;
    color: white;
    width: 165px;
    border-radius: 5px;
    white-space: nowrap;
  }
  #google_button:hover {
    background: #e74b37;
    cursor: hand;
  }
  span.google_icon {
    background: url('{{ STATIC_URL }}img/loginbox/google.png') transparent 5px 50% no-repeat;
    display: inline-block;
    vertical-align: middle;
    width: 35px;
    height: 35px;
    border-right: #bb3f30 1px solid;
  }
  span.google_buttonText {
    display: inline-block;
    vertical-align: middle;
    padding-left: 35px;
    padding-right: 35px;
    font-size: 14px;
    font-weight: bold;
    /* Use the Roboto font that is loaded in the <head> */
    font-family: 'Roboto',arial,sans-serif;
  }
</style>
<!-- In the callback, you would hide the gSignInWrapper element on a
successful sign in -->
<div id="gSignInWrapper">
  <div id="google_button" class="customGPlusSignIn">
    <span class="google_icon"></span>
    <span class="google_buttonText">Google</span>
  </div>
</div>
{% endmacro %}

{% block content %}

    <div class="loginbox">
        <img src="{{ STATIC_URL }}/img/loginbox/assembl.png" alt="Assembl" />

        <div class="spacer spacer--big"></div>
        <div class="error-message">{{error}}</div>
        {% if resend_url %}
        <a href="{{resend_url}}">{{ gettext("Send confirmation message") }}</a>
        {% endif %}
        <form class="form" method="POST">
            <input type="hidden" name="next_view" value="{{next_view}}" />

            <input type="text" name="identifier" class="defaultfield" placeholder="{{ gettext('Email or username') }}" autofocus required />

            <div class="spacer spacer--big"></div>

            <input type="password" name="password" class="defaultfield" placeholder="{{ gettext('Password') }}" required />
            <div class="spacer spacer--huge"></div>

            <input type="submit" name="login" value="{{ gettext('Enter') }}" class="barbutton" />

            <div class="spacer"></div>
        </form>
        <span>{{gettext("or")}} <a href="/register?next_view={{next_view}}">{{gettext("register")}}</a></span>


        {% if providers %}
        <p>{{ gettext("Login with external tools")|safe }}</p>
        {% endif %}
        {{form('facebook', 'Login with Facebook', true)}}

        {{form('twitter', 'Login with Twitter', true)}}
        {{form('bitbucket', 'Login with Bitbucket', false)}}
        {% if 'google' in providers %}
        {{google_login()}}
        {% endif %}
        {{form('github', 'Login with Github', false)}}
        {{form('yahoo', 'Login with Yahoo', true,
                oauth='true', openid_identifier='yahoo.com')}}
        {{form('openid', 'Login with OpenID', true)}}
        {{form('live', 'Login with Windows Live', false)}}
        <div class="spacer spacer--huge"></div>

        <div class="text text-small text-muted">
            {% set caravan = "<a href='http://caravan.coop' class='link'>"+gettext("Caravan")+"</a>" %}
            {% set imaginationForPeople = "<a href='http://imaginationforpeople.org/' class='link'>"+gettext("Imagination for people") +"</a>" %}

            {{ gettext("Designed by %(caravan)s and %(imaginationForPeople)s")|format(caravan=caravan, imaginationForPeople=imaginationForPeople)|safe }}
        </div>
        </form>
    </div>

{% endblock %}

{% block extra_js %}
<script type="text/javascript">requirejs(["main"]);</script>
{% endblock %}
