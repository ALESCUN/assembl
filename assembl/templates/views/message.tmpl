{% set userName = "<%= creator.get('name') %>" %}
{% set precise_date = "<%= ctx.getReadableDateTime(date) %>" %}
{% set nice_date = "<%= ctx.getNiceDateTime(date) %>" %}
    <div class="avatar">
        <img src="<%= creator.getAvatarUrl(30) %>" alt="{{ gettext('User') }}"  class="image-rounded" width="30" height="30" />
    </div>
<header class="message-header">

<% if ( viewStyle == ctx.AVAILABLE_MESSAGE_VIEW_STYLES.TITLE_ONLY ){ %>
        <span class="message-author">{{ gettext('%(user)s')|format(user=userName)|safe }}&nbsp;&nbsp;</span>
        <span class="message-subject"><%= subject %></span>
        <span class="message-date">{{ gettext('<time title="%(precise_date)s">%(nice_date)s</time>')|format(nice_date=nice_date,precise_date=precise_date)|safe }}</span>
        {# <span class="text-muted"><%= ctx.stripHtml(body) %></span> #}
<% } else if ( viewStyle == ctx.AVAILABLE_MESSAGE_VIEW_STYLES.PREVIEW || viewStyle == ctx.AVAILABLE_MESSAGE_VIEW_STYLES.FULL_BODY ){ %>
        <% if ( user_is_connected ){ %>
        <div class="readUnreadIndicator">
            <span class="indice 
                <% if (read){ %>
                    js_message-markasunread
                <% } else { %>
                    js_message-markasread
                <% } %>"
                data-toggle="tooltip" title="
                <% if (read){ %>
                    {{ gettext('Mark as unread') }}
                <% } else { %>
                    {{ gettext('Mark as read') }}
                <% } %>"
                data-placement="left"
                >
            </span>
        </div>
        <% } %>
        
        <span class="message-author">{{ gettext('%(user)s')|format(user=userName)|safe }}&nbsp;&nbsp;</span>
        <span class="message-date">{{ gettext('<time title="%(precise_date)s">%(nice_date)s</time>')|format(nice_date=nice_date,precise_date=precise_date)|safe }}</span>
        <span class="message-subject"><%= subject %></span>
<% } %>

</header>

    <% if ( viewStyle == ctx.AVAILABLE_MESSAGE_VIEW_STYLES.FULL_BODY ){ %>
    <div class="message-menu">
        <div class="dropdown">
            <span class="dropdown-label">More options</span>
            <ul class="dropdown-list dropdown-list--bottomright">
                <% if (user_is_connected){ %>
                    <% if (read){ %>
                        <li class="js_message-markasunread dropdown-listitem"><a class="iconbutton"></a> {{ gettext('Mark as unread') }}</li>
                    <% } else { %>
                        <li class="js_message-markasread dropdown-listitem"><a class="iconbutton"></a> {{ gettext('Mark as read') }}</li>
                    <% } %>
                <% } %>

                <% if( isHoisted == true ){ %>
                    <li class="dropdown-listitem message-hoistbtn" data-id="<%= escape(id) %>"><a class="iconbutton icon-upload"></a> {{gettext('Go back to the entire topic thread')}}</li>
                <% } else { %>
                    <li class="dropdown-listitem message-hoistbtn" data-id="<%= escape(id) %>"><a class="iconbutton icon-download"></a> {{gettext('Show only this message and its replies')}}</li>
                <% } %>

                <li class="dropdown-listitem message-linkbutton" data-copy-text="/message/<%= escape(id) %>"><a class="iconbutton icon-link"></a> {{gettext('Copy the link to this message to clipboard')}}</li>

                <% if (creator.get('email')) { %>
                <li class="dropdown-listitem">
                    <a title="<%= creator.get('email') %>" href="mailto:<%= creator.get('email') %>"><i class="iconbutton icon-mail"></i>
                    {{gettext('Send an email to this user')}}</a>
                </li>
                <% } %>
            </ul>
        </div>
    </div>
    <% } %>
<% if( viewStyle == ctx.AVAILABLE_MESSAGE_VIEW_STYLES.PREVIEW || viewStyle == ctx.AVAILABLE_MESSAGE_VIEW_STYLES.FULL_BODY ){ %>
    {#   Body section
         Note:  bodyFormatClass can currently have values body_format_text_plain or  body_format_text_html 
    #}
    <% if( viewStyle == ctx.AVAILABLE_MESSAGE_VIEW_STYLES.PREVIEW ){ %>
        <div class="message-body <%= bodyFormatClass %> ellipsis" id="<%= messageBodyId %>">
            <p class="mvn more"><%= body %></p>{# Do NOT introduce whitespace within this div #}
        </div>
        <div>
          <a class="readmore" href="#" alt="{{ gettext('Read More') }}">{{ gettext('Read More') }}</a>
        </div>
    <% } else if( viewStyle == ctx.AVAILABLE_MESSAGE_VIEW_STYLES.FULL_BODY ){ %>
        <div class="message-body js_messageBodyAnnotatorSelectionAllowed <%= bodyFormatClass %>" id="<%= messageBodyId %>"><%= body %></div>
    
        <div class="message-replybox"></div>
    <% } %>
    <div class="message-menu mvs">
        {#
        <% if( isHoisted == true ){ %>
            <a class="message-hoistbtn iconbutton icon-upload" data-id="<%= escape(id) %>" data-toggle="tooltip" title="{{gettext('Go back to the entire topic thread')}}"></a>
        <% } else { %>
            <a class="message-hoistbtn iconbutton icon-download" data-id="<%= escape(id) %>" data-toggle="tooltip" title="{{gettext('Show only this message and its replies')}}"></a>
        <% } %>
        #}

        <% if( viewStyle == ctx.AVAILABLE_MESSAGE_VIEW_STYLES.PREVIEW ){ %>
            <a class="message-replybox-openbtn"><i class="icon-answer"></i>&nbsp;&nbsp;{{ gettext("Reply") }}</a>
        <% } %>
    </div>
<% } %>