{% extends 'base.jinja2' %}

{% block extra_header %}{% endblock %}

{% block content %}
    <div class="bar bar--title">
        <div class="bar-left">
            Non du débat
        </div>
        <div class="bar-center">
            <a class="barbutton">TDM</a>
            <a class="barbutton">Synthèse</a>
            <a class="barbutton">Presse-papier</a>
            <a class="barbutton">Messages</a>
        </div>
    </div>
    <div>
        <div id="inbox" class="panel"></div>

        <div id="segmentlist" class="panel"></div>

        <div id="message" class="panel"></div>
    </div>
{% endblock %}

{% block extra_js %}
<script type="text/javascript">
requirejs([
    "app",
    "jquery",
    "views/inbox",
    "views/lateralMenu",
    "views/segmentList",
    "views/message",
    "models/email"
], function(app, $, Inbox, LateralMenu, SegmentList, Message, Email){
    'use strict';

    app.init();

    // Inbox
    var inboxEmails = new Email.Collection();
    app.inbox = new Inbox({collection: inboxEmails}).render();
    app.inbox.collection.fetch({reset: true});

    // Lateral menu
    var lateralMenuEmails = new Email.Collection();
    app.lateralMenu = new LateralMenu({el: '#lateralMenu', emails: lateralMenuEmails});
    app.lateralMenu.emails.fetch({reset: true});

    $('#assembl-mainbutton').on('click', app.lateralMenu.trigger.bind(app.lateralMenu, 'toggle'));

    // SegmentList
    app.segmentList = new SegmentList({el: '#segmentlist'}).render();
    app.on('lateralmenu.open', function(){
        app.bucket.setLeftMargin(app.lateralMenuWidth);
    });
    app.on('lateralmenu.close', function(){
        app.bucket.setLeftMargin(0);
    });

    // Message
    app.message = new Message({el: '#message'}).render();
    app.on('lateralmenu.open', function(){
        app.message.hideTooltip();
    });
    app.selectionTooltip.on('click', function(){
        app.selectionTooltip.hide();
        var segment = app.selectionTooltip.attr('data-segment');
        app.bucket.addSegment(segment);
    });


});
</script>
{% endblock %}
